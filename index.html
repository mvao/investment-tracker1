<!-- Investment Tracker â€” Futuristic Neon v4.1 (with only cumulative chart) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Investment Tracker â€” Futuristic Neon v4.1 (Cumulative Only)</title>
  <style>
    body {
      background-color: #000;
      color: #0f0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      overflow-x: hidden;
    }
    h2 {
      font-size: 1.6rem;
      margin-bottom: 10px;
      color: #0f0;
      text-shadow: 0 0 8px #0f0;
    }
    input, select, button {
      background-color: #111;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 10px;
      border-radius: 6px;
      margin: 5px;
      font-size: 1rem;
    }
    input[type="month"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
    }
    button {
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #0f0;
      color: #000;
    }
    .calendar-btn {
      background: none;
      border: none;
      color: #ccc;
      font-size: 1.3rem;
      cursor: pointer;
      vertical-align: middle;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #0f0;
      padding: 8px;
      text-align: center;
      font-size: 1rem;
    }
    th {
      background-color: #010;
      font-size: 1.2rem;
    }
    details {
      margin-top: 10px;
      border: 1px solid #0f0;
      border-radius: 8px;
      padding: 10px;
    }
    summary {
      font-size: 1.2rem;
      cursor: pointer;
      color: #0f0;
    }
    canvas {
      width: 100% !important;
      max-width: 800px;
      height: 400px !important;
      margin-top: 20px;
      display: block;
    }
  </style>
</head>
<body>
  <h2>Add Investment</h2>
  <div>
    <input type="month" id="monthInput" />
    <button class="calendar-btn" id="calendarIcon">ðŸ“…</button>
    <input type="number" id="amountInput" placeholder="Amount (R$)" />
    <select id="categoryInput">
      <option value="Brazil">Brazil</option>
      <option value="USA">USA</option>
      <option value="Crypto">Crypto</option>
    </select>
    <button id="addBtn">Add</button>
  </div>

  <h2>Cumulative Totals</h2>
  <canvas id="cumulativeChart"></canvas>

  <div id="tables"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const monthInput = document.getElementById('monthInput');
    const calendarIcon = document.getElementById('calendarIcon');
    const amountInput = document.getElementById('amountInput');
    const categoryInput = document.getElementById('categoryInput');
    const addBtn = document.getElementById('addBtn');
    const tablesDiv = document.getElementById('tables');

    calendarIcon.addEventListener('click', () => {
      if (monthInput.showPicker) monthInput.showPicker();
      else monthInput.focus();
    });

    let data = JSON.parse(localStorage.getItem('investments_v4')) || [];

    function saveData() {
      localStorage.setItem('investments_v4', JSON.stringify(data));
    }

    function formatMonthYear(dateStr) {
      const [year, month] = dateStr.split('-');
      const d = new Date(year, month - 1);
      return d.toLocaleString('default', { month: 'long', year: 'numeric' })
        .replace(/^./, str => str.toUpperCase());
    }

    function addInvestment() {
      const date = monthInput.value;
      const amount = parseFloat(amountInput.value);
      const category = categoryInput.value;
      if (!date || isNaN(amount)) return;
      data.push({ date, amount, category });
      saveData();
      amountInput.value = '';
      updateDisplay();
    }

    addBtn.addEventListener('click', addInvestment);

    function groupByYear() {
      const grouped = {};
      data.forEach(item => {
        const [year] = item.date.split('-');
        if (!grouped[year]) grouped[year] = [];
        grouped[year].push(item);
      });
      return grouped;
    }

    function updateDisplay() {
      tablesDiv.innerHTML = '';
      const grouped = groupByYear();
      for (const year of Object.keys(grouped).sort()) {
        const details = document.createElement('details');
        const summary = document.createElement('summary');
        summary.textContent = year;
        details.appendChild(summary);

        const tablesContainer = document.createElement('div');
        ['Brazil', 'USA', 'Crypto'].forEach(cat => {
          const table = document.createElement('table');
          const header = document.createElement('tr');
          header.innerHTML = `<th colspan="3">${cat}</th>`;
          table.appendChild(header);
          const subHeader = document.createElement('tr');
          subHeader.innerHTML = '<th>Month</th><th>Amount (R$)</th><th>Category</th>';
          table.appendChild(subHeader);

          const filtered = grouped[year].filter(i => i.category === cat);
          let total = 0;
          filtered.forEach(i => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${formatMonthYear(i.date)}</td><td>${i.amount.toFixed(2)}</td><td>${i.category}</td>`;
            table.appendChild(row);
            total += i.amount;
          });

          const totalRow = document.createElement('tr');
          totalRow.innerHTML = `<td colspan="2"><strong>Total</strong></td><td><strong>${total.toFixed(2)}</strong></td>`;
          table.appendChild(totalRow);
          tablesContainer.appendChild(table);
        });
        details.appendChild(tablesContainer);
        tablesDiv.appendChild(details);
      }
      updateCumulativeChart();
    }

    let cumulativeChart;
    function updateCumulativeChart() {
      const ctx = document.getElementById('cumulativeChart').getContext('2d');
      const yearlyTotals = {};
      data.forEach(i => {
        const [year] = i.date.split('-');
        if (!yearlyTotals[year]) yearlyTotals[year] = { Brazil: 0, USA: 0, Crypto: 0 };
        yearlyTotals[year][i.category] += i.amount;
      });

      const years = Object.keys(yearlyTotals).sort();
      let running = { Brazil: 0, USA: 0, Crypto: 0 };
      const cum = years.map(y => {
        running.Brazil += yearlyTotals[y].Brazil;
        running.USA += yearlyTotals[y].USA;
        running.Crypto += yearlyTotals[y].Crypto;
        return { year: y, ...running };
      });

      const datasets = [
        { label: 'Brazil', borderColor: '#00ff00', data: cum.map(c => c.Brazil), fill: false },
        { label: 'USA', borderColor: '#00bfff', data: cum.map(c => c.USA), fill: false },
        { label: 'Crypto', borderColor: '#b700ff', data: cum.map(c => c.Crypto), fill: false }
      ];

      if (cumulativeChart) cumulativeChart.destroy();
      cumulativeChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: '#0f0',
                font: { size: 14 }
              }
            }
          },
          scales: {
            x: { ticks: { color: '#0f0' }, grid: { color: '#0f03' } },
            y: { ticks: { color: '#0f0' }, grid: { color: '#0f03' } }
          }
        }
      });
    }

    updateDisplay();
  </script>
</body>
</html>
